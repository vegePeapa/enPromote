# å¤šç« èŠ‚å­¦ä¹ ç³»ç»Ÿå‡çº§è¯´æ˜

## æ¦‚è¿°

æœ¬æ¬¡å‡çº§å°†åŸæœ‰çš„å•ä¸€å­¦ä¹ è·¯å¾„æ”¹é€ ä¸ºå¤šç« èŠ‚"å¤šé‚»å›½"é£æ ¼çš„å­¦ä¹ ç³»ç»Ÿï¼Œæ”¯æŒä¸åŒåœºæ™¯çš„è‹±è¯­å­¦ä¹ ã€‚

## æ–°åŠŸèƒ½ç‰¹æ€§

### 1. å¤šç« èŠ‚æ”¯æŒ
- **Aç« èŠ‚**: é…’åº—åœºæ™¯ - å­¦ä¹ é…’åº—å…¥ä½ã€é€€æˆ¿ç­‰ç›¸å…³è‹±è¯­
- **Bç« èŠ‚**: é¤å…åœºæ™¯ - å­¦ä¹ é¤å…ç‚¹é¤ã€ç”¨é¤ç­‰ç›¸å…³è‹±è¯­
- æ¯ä¸ªç« èŠ‚éƒ½æœ‰ç‹¬ç‰¹çš„èƒŒæ™¯ä¸»é¢˜å’Œè¯æ±‡åº“

### 2. çºµå‘æ»šåŠ¨å…³å¡åœ°å›¾
- é‡‡ç”¨çºµå‘æ»šåŠ¨çš„å…³å¡åœ°å›¾å¸ƒå±€ï¼Œç±»ä¼¼æ¸¸æˆå…³å¡ç³»ç»Ÿ
- å…³å¡æµç¨‹ï¼š
  ```
  ...
   |           // ç”¨æˆ·å¯å‘ä¸Šæ»‘åŠ¨æŸ¥çœ‹å†å²å®Œæˆçš„å…³å¡
  AIå¯¹è¯ (å·²å®Œæˆ)
  ------------------
  å•è¯å­¦ä¹  (å½“å‰ç« èŠ‚ n)
   |
  æ‹¼å†™ç»ƒä¹ 
   |
  æƒ…æ™¯å¯¹è¯
   |
  ...
  ------------------
  å•è¯å­¦ä¹  (ä¸‹ä¸€ç« èŠ‚ n+1ï¼Œæœªè§£é”çŠ¶æ€)
  ```
- å…³å¡è§£é”æœºåˆ¶ï¼š
  - å½“å‰ç« èŠ‚å¿…é¡»å®Œæˆæ‰€æœ‰å…³å¡æ‰èƒ½è§£é”ä¸‹ä¸€ç« èŠ‚
  - æœªè§£é”çš„ç« èŠ‚åªæ˜¾ç¤ºç¬¬ä¸€ä¸ªå…³å¡ï¼ˆå•è¯å­¦ä¹ ï¼‰ä½œä¸ºé¢„è§ˆ
  - ç”¨æˆ·å¯ä»¥å‘ä¸Šæ»šåŠ¨æŸ¥çœ‹å·²å®Œæˆçš„å†å²å…³å¡

### 3. ç« èŠ‚ç‰¹å®šå†…å®¹
- æ¯ä¸ªç« èŠ‚æœ‰å¯¹åº”çš„è¯æ±‡åº“å’ŒAIæç¤ºè¯
- AIå¯¹è¯è‡ªåŠ¨é€‚åº”å½“å‰ç« èŠ‚åœºæ™¯ï¼ˆæ— éœ€ç”¨æˆ·é€‰æ‹©ï¼‰
  - é…’åº—åœºæ™¯ï¼šAIæ‰®æ¼”é…’åº—å‰å°å·¥ä½œäººå‘˜
  - é¤å…åœºæ™¯ï¼šAIæ‰®æ¼”é¤å…æœåŠ¡å‘˜
  - æœºåœºåœºæ™¯ï¼šAIæ‰®æ¼”æœºåœºå·¥ä½œäººå‘˜
- ç« èŠ‚ç‰¹å®šçš„å­¦ä¹ è¿›åº¦è·Ÿè¸ª
- ç‹¬ç«‹çš„ç« èŠ‚å®Œæˆåº¦ç»Ÿè®¡
- æœªè§£é”ç« èŠ‚ä»…æ˜¾ç¤ºç¬¬ä¸€å…³ï¼ˆå•è¯å­¦ä¹ ï¼‰ï¼Œå…¶ä»–å…³å¡å®Œå…¨éšè—

## æ•°æ®åº“å˜æ›´

### Useræ¨¡å‹æ›´æ–°
```javascript
// æ–°å¢å­—æ®µ
chapters: {
  type: Map,
  of: {
    level: Number,
    score: Number, 
    completedWords: Number,
    wordP: Boolean,
    spellP: Boolean,
    listenP: Boolean,
    customsP: Boolean,
    coverP: Boolean
  }
},
currentChapter: String // 'A' æˆ– 'B'
```

### Wordæ¨¡å‹æ›´æ–°
```javascript
// æ–°å¢å­—æ®µ
chapter: String,    // 'A', 'B'
scenario: String    // 'hotel', 'restaurant'
```

## APIæ¥å£å˜æ›´

### æ–°å¢æ¥å£
- `POST /auth/switch-chapter` - åˆ‡æ¢å­¦ä¹ ç« èŠ‚
- å‚æ•°: `{ chapter: 'A' | 'B' }`

### æ›´æ–°æ¥å£
- `GET /auth/info` - è¿”å›æ•°æ®æ–°å¢ç« èŠ‚ä¿¡æ¯å’Œå½“å‰ç« èŠ‚
- `GET /commend-words/get-words` - æ”¯æŒç« èŠ‚å‚æ•°è¿‡æ»¤
- `POST /ai/ai_generate_question` - è‡ªåŠ¨æ ¹æ®ç”¨æˆ·å½“å‰ç« èŠ‚é€‰æ‹©å¯¹åº”åœºæ™¯çš„AIæç¤ºè¯
  - æ— éœ€å‰ç«¯ä¼ é€’åœºæ™¯å‚æ•°ï¼Œåç«¯è‡ªåŠ¨åˆ¤æ–­
  - é…’åº—åœºæ™¯ä½¿ç”¨é…’åº—å‰å°æç¤ºè¯
  - é¤å…åœºæ™¯ä½¿ç”¨é¤å…æœåŠ¡å‘˜æç¤ºè¯

## å‰ç«¯ç»„ä»¶å˜æ›´

### æ–°å¢é¡µé¢
- `ChapterSelection.vue` - ç« èŠ‚é€‰æ‹©é¡µé¢
- `AdventureMap.vue` - çºµå‘æ»šåŠ¨å…³å¡åœ°å›¾é¡µé¢

### å…³å¡åœ°å›¾ç»„ä»¶è®¾è®¡
- `LevelNode.vue` - å•ä¸ªå…³å¡èŠ‚ç‚¹ç»„ä»¶
  - æ”¯æŒä¸åŒçŠ¶æ€ï¼šå·²å®Œæˆã€å½“å‰å¯ç©ã€é”å®šã€é¢„è§ˆ
  - æ˜¾ç¤ºå…³å¡ç±»å‹å›¾æ ‡å’Œè¿›åº¦
- `ChapterDivider.vue` - ç« èŠ‚åˆ†éš”çº¿ç»„ä»¶
  - æ˜¾ç¤ºç« èŠ‚å®ŒæˆçŠ¶æ€å’Œè§£é”æç¤º
- `ScrollableMap.vue` - å¯æ»šåŠ¨åœ°å›¾å®¹å™¨
  - æ”¯æŒå‘ä¸Šæ»šåŠ¨æŸ¥çœ‹å†å²å…³å¡
  - è‡ªåŠ¨å®šä½åˆ°å½“å‰å¯ç©å…³å¡

### è·¯ç”±æ›´æ–°
- `/chapters` - ç« èŠ‚é€‰æ‹©é¡µé¢
- `/adventure-map` - çºµå‘æ»šåŠ¨å…³å¡åœ°å›¾é¡µé¢
- `/level/:type/:chapter` - å…·ä½“å…³å¡æ¸¸æˆé¡µé¢

## éƒ¨ç½²æ­¥éª¤

### 1. æ•°æ®è¿ç§»
```bash
# è¿è¡Œæ•°æ®è¿ç§»è„šæœ¬
cd server
node scripts/migrateToChapters.js
```

### 2. æ›´æ–°ä¾èµ–
```bash
# å‰ç«¯
cd en_ui
npm install

# åç«¯
cd server  
npm install
```

### 3. å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨åç«¯
cd server
npm start

# å¯åŠ¨å‰ç«¯
cd en_ui
npm run dev
```

## UIè®¾è®¡è¯¦æƒ…

### çºµå‘æ»šåŠ¨å…³å¡åœ°å›¾å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å‘ä¸Šæ»‘åŠ¨æŸ¥çœ‹å†å²           â”‚
â”‚             â†‘                   â”‚
â”‚      AIå¯¹è¯(é…’åº—åœºæ™¯) âœ“         â”‚
â”‚           â”‚                     â”‚
â”‚        æƒ…æ™¯å¯¹è¯ âœ“               â”‚
â”‚           â”‚                     â”‚
â”‚        æ‹¼å†™ç»ƒä¹  âœ“               â”‚
â”‚           â”‚                     â”‚
â”‚        å•è¯å­¦ä¹  âœ“               â”‚
â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚ â† ç« èŠ‚åˆ†éš”çº¿ (é…’åº—åœºæ™¯å®Œæˆ)
â”‚        å•è¯å­¦ä¹  â—               â”‚ â† å½“å‰å¯ç©å…³å¡ (é¤å…åœºæ™¯)
â”‚           â”‚                     â”‚
â”‚        æ‹¼å†™ç»ƒä¹  ğŸ”’              â”‚
â”‚           â”‚                     â”‚
â”‚        æƒ…æ™¯å¯¹è¯ ğŸ”’              â”‚
â”‚           â”‚                     â”‚
â”‚     AIå¯¹è¯(é¤å…åœºæ™¯) ğŸ”’         â”‚
â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚ â† ç« èŠ‚åˆ†éš”çº¿
â”‚        å•è¯å­¦ä¹  ğŸ”’              â”‚ â† æœªè§£é”ç« èŠ‚é¢„è§ˆ (æœºåœºåœºæ™¯)
â”‚          ï¼Ÿï¼Ÿï¼Ÿ                 â”‚ â† å…¶ä»–å…³å¡å®Œå…¨éšè—
â”‚             â†“                   â”‚
â”‚        å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³å¡çŠ¶æ€è¯´æ˜
- âœ“ **å·²å®Œæˆ**: ç»¿è‰²èƒŒæ™¯ï¼Œæ˜¾ç¤ºå®Œæˆæ ‡è®°
- â— **å½“å‰å¯ç©**: é«˜äº®æ˜¾ç¤ºï¼Œå¯ç‚¹å‡»è¿›å…¥
- ğŸ”’ **é”å®š**: ç°è‰²æ˜¾ç¤ºï¼Œä¸å¯ç‚¹å‡»
- **é¢„è§ˆ**: åŠé€æ˜æ˜¾ç¤ºï¼Œä»…æ˜¾ç¤ºæœªè§£é”ç« èŠ‚çš„ç¬¬ä¸€å…³ï¼ˆå•è¯å­¦ä¹ ï¼‰ï¼Œå…¶ä»–å…³å¡å®Œå…¨éšè—

## ä½¿ç”¨æµç¨‹

1. **ç™»å½•ç³»ç»Ÿ** - ç”¨æˆ·ç™»å½•åä¼šè‡ªåŠ¨è¿ç§»åˆ°æ–°çš„ç« èŠ‚ç³»ç»Ÿ
2. **é€‰æ‹©ç« èŠ‚** - åœ¨ç« èŠ‚é€‰æ‹©é¡µé¢é€‰æ‹©è¦å­¦ä¹ çš„åœºæ™¯
3. **å…³å¡åœ°å›¾** - è¿›å…¥çºµå‘æ»šåŠ¨çš„å…³å¡åœ°å›¾
4. **å…³å¡æŒ‘æˆ˜** - ç‚¹å‡»å½“å‰å¯ç©å…³å¡è¿›å…¥å­¦ä¹ 
5. **è¿›åº¦è¿½è¸ª** - å®Œæˆå…³å¡åè‡ªåŠ¨è§£é”ä¸‹ä¸€å…³å¡
6. **ç« èŠ‚åˆ‡æ¢** - å¯éšæ—¶è¿”å›ç« èŠ‚é€‰æ‹©é¡µé¢

## å…¼å®¹æ€§è¯´æ˜

- ä¿æŒäº†åŸæœ‰çš„`cet4`å­—æ®µï¼Œç¡®ä¿å‘åå…¼å®¹
- ç°æœ‰ç”¨æˆ·æ•°æ®ä¼šè‡ªåŠ¨è¿ç§»åˆ°æ–°çš„ç« èŠ‚ç³»ç»Ÿ
- åŸæœ‰çš„APIæ¥å£ä¿æŒå¯ç”¨ï¼ŒåŒæ—¶æ”¯æŒæ–°çš„ç« èŠ‚å‚æ•°

## é…ç½®æ–‡ä»¶

### ç« èŠ‚é…ç½® (`server/config/chapters.js`)
```javascript
const CHAPTERS = {
  A: {
    name: 'é…’åº—åœºæ™¯',
    scenario: 'hotel',
    color: '#4A90E2',
    aiPrompt: 'é…’åº—å‰å°å·¥ä½œäººå‘˜æç¤ºè¯...'
  },
  B: {
    name: 'é¤å…åœºæ™¯', 
    scenario: 'restaurant',
    color: '#F5A623',
    aiPrompt: 'é¤å…æœåŠ¡å‘˜æç¤ºè¯...'
  }
}
```

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®å¤‡ä»½**: å‡çº§å‰è¯·å¤‡ä»½æ•°æ®åº“
2. **æ¸è¿›å¼éƒ¨ç½²**: å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
3. **ç”¨æˆ·é€šçŸ¥**: æå‰é€šçŸ¥ç”¨æˆ·ç³»ç»Ÿå‡çº§å†…å®¹
4. **ç›‘æ§æ—¥å¿—**: å‡çº§åå¯†åˆ‡å…³æ³¨é”™è¯¯æ—¥å¿—

## æŠ€æœ¯å®ç°è¦ç‚¹

### æ»šåŠ¨å®šä½é€»è¾‘
```javascript
// è‡ªåŠ¨æ»šåŠ¨åˆ°å½“å‰å¯ç©å…³å¡
const scrollToCurrentLevel = () => {
  const currentLevelElement = document.querySelector('.level-current');
  if (currentLevelElement) {
    currentLevelElement.scrollIntoView({ 
      behavior: 'smooth', 
      block: 'center' 
    });
  }
};
```

### å…³å¡çŠ¶æ€è®¡ç®—
```javascript
const getLevelStatus = (levelIndex, chapterIndex, userProgress) => {
  const currentChapter = userProgress.currentChapter;
  const chapterProgress = userProgress.chapters[currentChapter];
  
  if (chapterIndex < currentChapter) return 'completed';
  if (chapterIndex > currentChapter) {
    // æœªè§£é”ç« èŠ‚åªæ˜¾ç¤ºç¬¬ä¸€å…³ï¼ˆå•è¯å­¦ä¹ ï¼‰ï¼Œå…¶ä»–å…³å¡éšè—
    return levelIndex === 0 ? 'preview' : 'hidden';
  }
  if (levelIndex <= chapterProgress.currentLevel) return 'available';
  return 'locked';
};

const shouldShowLevel = (levelIndex, chapterIndex, userProgress) => {
  const status = getLevelStatus(levelIndex, chapterIndex, userProgress);
  // éšè—çŠ¶æ€çš„å…³å¡ä¸æ˜¾ç¤ºåœ¨åœ°å›¾ä¸Š
  return status !== 'hidden';
};
```

### æ— é™æ»šåŠ¨ä¼˜åŒ–
- ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨æŠ€æœ¯å¤„ç†å¤§é‡å…³å¡èŠ‚ç‚¹
- æ‡’åŠ è½½å†å²å…³å¡æ•°æ®
- é¢„åŠ è½½ä¸‹ä¸€ç« èŠ‚çš„é¢„è§ˆä¿¡æ¯

## åç»­æ‰©å±•

- å¯è½»æ¾æ·»åŠ æ›´å¤šç« èŠ‚ï¼ˆCã€Dç­‰ï¼‰
- æ”¯æŒæ›´å¤šåœºæ™¯ç±»å‹ï¼ˆæœºåœºã€è´­ç‰©ç­‰ï¼‰
- ç« èŠ‚é—´çš„ä¾èµ–å…³ç³»é…ç½®
- æˆå°±ç³»ç»Ÿå’Œå¾½ç« å¥–åŠ±
- å…³å¡åœ°å›¾ä¸»é¢˜åˆ‡æ¢ï¼ˆä¸åŒåœºæ™¯çš„è§†è§‰é£æ ¼ï¼‰
- ç¤¾äº¤åŠŸèƒ½ï¼ˆå¥½å‹è¿›åº¦å¯¹æ¯”ï¼‰